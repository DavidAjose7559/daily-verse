<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Daily Verse â€” Admin</title>
  <link rel="stylesheet" href="./style.css">
  <style>
    .card { max-width: 720px; margin: 48px auto; padding: 1rem; border-radius: 12px; background: var(--card); }
    .row { display:flex; gap:.75rem; flex-wrap:wrap; margin:.5rem 0; }
    input { flex:1; padding:.6rem .8rem; border:1px solid var(--border); border-radius:10px; background:var(--bg); color:var(--text); }
    label { font-weight:600; display:block; margin-top:.5rem; }
    .btn { padding:.6rem .9rem; border-radius:10px; border:1px solid var(--border); background:var(--bg); cursor:pointer; }
    .muted { opacity:.8 }
  </style>
</head>
<body>
  <main class="card">
    <h1>Admin: Set Verse</h1>
    <p class="muted">Generate & save a specific verse for any date. Requires your admin token.</p>

    <label>Admin Token</label>
    <div class="row">
      <input id="token" type="password" placeholder="Paste ADMIN_TOKEN" />
      <button class="btn" id="saveTok">Save</button>
    </div>

    <label>Date (YYYY-MM-DD)</label>
    <input id="date" placeholder="2025-10-15" />

    <label>Reference (optional, e.g., John 3:16)</label>
    <input id="ref" placeholder="Leave blank to auto-pick" />

    <div class="row">
      <button class="btn" id="generate">Generate</button>
      <a class="btn" href="./">Back to Site</a>
    </div>

    <pre id="out" class="muted"></pre>
  </main>

  <script>
    const API = 'https://daily-verse-viewer.onrender.com';

    // load saved token
    const tokEl = document.getElementById('token');
    tokEl.value = localStorage.getItem('dv_admin_token') || '';

    document.getElementById('saveTok').onclick = () => {
      localStorage.setItem('dv_admin_token', tokEl.value.trim());
      alert('Saved.');
    };

    document.getElementById('generate').onclick = async () => {
      const token = (document.getElementById('token').value || '').trim();
      const date  = (document.getElementById('date').value || '').trim();
      const ref   = (document.getElementById('ref').value || '').trim();
      if (!token) return alert('Token required.');
      if (!/^\d{4}-\d{2}-\d{2}$/.test(date)) return alert('Date must be YYYY-MM-DD');

      const body = { date };
      if (ref) body.reference = ref;

      try {
        const res = await fetch(`${API}/api/admin/generate`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(body)
        });
        const data = await res.json();
        document.getElementById('out').textContent = JSON.stringify(data, null, 2);
        if (data.ok) alert(`Saved ${data.reference} for ${data.date}`);
        else alert('Failed: ' + (data.error || res.status));
      } catch (e) {
        alert('Network error');
      }
    };
  </script>
</body>
</html>
